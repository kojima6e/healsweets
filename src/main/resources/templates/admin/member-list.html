<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会員管理 - HealSweets</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
</head>
<body>
    <div th:replace="~{fragments/admin-header :: adminHeader}"></div>

    <main class="admin-container">
        <div class="admin-page-header">
            <h1>会員管理</h1>
            <p>登録会員の一覧・管理</p>
        </div>

        <!-- メッセージ表示 -->
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <!-- 会員一覧テーブル -->
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>氏名</th>
                        <th>メールアドレス</th>
                        <th>電話番号</th>
                        <th>権限</th>
                        <th>ステータス</th>
                        <th>登録日</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:if="${#lists.isEmpty(members)}">
                        <td colspan="8" class="no-data">会員が登録されていません</td>
                    </tr>
                    <tr th:each="member : ${members}">
                        <td th:text="${member.id}">1</td>
                        <td th:text="${member.fullName}">田中 太郎</td>
                        <td th:text="${member.email}">tanaka@example.com</td>
                        <td th:text="${member.phone ?: '-'}">090-1234-5678</td>
                        <td>
                            <span th:if="${member.isAdmin()}" class="badge badge-admin">管理者</span>
                            <span th:unless="${member.isAdmin()}" class="badge badge-user">一般</span>
                        </td>
                        <td>
                            <span th:if="${member.enabled}" class="status-badge active">有効</span>
                            <span th:unless="${member.enabled}" class="status-badge inactive">無効</span>
                        </td>
                        <td th:text="${#temporals.format(member.createdAt, 'yyyy/MM/dd')}">2025/01/01</td>
                        <td>
                            <div class="action-buttons">
                                <form th:if="${member.enabled and !member.isAdmin()}" 
                                      th:action="@{/admin/members/{id}/delete(id=${member.id})}" 
                                      method="post" 
                                      style="display: inline;"
                                      onsubmit="return confirm('この会員を無効化してもよろしいですか？');">
                                    <button type="submit" class="btn btn-danger btn-sm">無効化</button>
                                </form>
                                <form th:if="${!member.enabled}" 
                                      th:action="@{/admin/members/{id}/restore(id=${member.id})}" 
                                      method="post" 
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-success btn-sm">復元</button>
                                </form>
                                <span th:if="${member.isAdmin()}" class="text-muted">管理者</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 会員統計 -->
        <div class="member-stats">
            <div class="stat-item">
                <span class="stat-label">総会員数:</span>
                <span class="stat-value" th:text="${#lists.size(members)}">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">有効会員:</span>
                <span class="stat-value" th:text="${#lists.size(members.?[enabled == true])}">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">無効会員:</span>
                <span class="stat-value" th:text="${#lists.size(members.?[enabled == false])}">0</span>
            </div>
        </div>
    </main>

</body>
</html>
