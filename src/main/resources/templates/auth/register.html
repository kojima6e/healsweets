<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>С╝џтЊАуЎ╗жї▓ - HealSweets</title>
    <link rel="icon" type="image/png" th:href="@{/images/favicon.png}">
    <link rel="stylesheet" th:href="@{/css/register-style.css}">
</head>
<body>
    <!-- сЃўсЃЃсЃђсЃ╝ -->
    <header th:replace="~{fragments/header :: headerSimple}"></header>

    <!-- уЎ╗жї▓сЃЋсѓЕсЃ╝сЃасѓ╗сѓ»сѓисЃДсЃ│ -->
    <section class="register-section">
        <div class="container">
            <div class="register-container">
                <div class="register-header">
                    <h1>С╝џтЊАуЎ╗жї▓</h1>
                    <p>HealSweetsсЂИсѓѕсЂєсЂЊсЂЮ№╝ЂТќ░УдЈсѓбсѓФсѓдсЃ│сЃѕсѓњСйюТѕљсЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ</p>
                </div>

                <!-- сѓесЃЕсЃ╝сЃАсЃЃсѓ╗сЃ╝сѓИ -->
                <div th:if="${errorMessage}" class="alert alert-error">
                    <p th:text="${errorMessage}">сѓесЃЕсЃ╝</p>
                </div>

                <form class="register-form" id="registerForm" th:action="@{/register}" 
                      th:object="${memberDto}" method="post">
                    
                    <!-- сѓ╣сЃєсЃЃсЃЌсѓцсЃ│сѓИсѓ▒сЃ╝сѓ┐сЃ╝ -->
                    <div class="step-indicator">
                        <div class="step active" id="stepIndicator1">
                            <div class="step-number">1</div>
                            <div class="step-label">тЪ║ТюгТЃЁта▒</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" id="stepIndicator2">
                            <div class="step-number">2</div>
                            <div class="step-label">СйЈТЅђТЃЁта▒</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" id="stepIndicator3">
                            <div class="step-number">3</div>
                            <div class="step-label">сѓбсЃгсЃФсѓ«сЃ╝ТЃЁта▒</div>
                        </div>
                    </div>

                    <!-- сѓ╣сЃєсЃЃсЃЌ1: тЪ║ТюгТЃЁта▒ -->
                    <div class="form-step active" id="step1">
                        <h2>тЪ║ТюгТЃЁта▒сЂ«тЁЦтіЏ</h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label>тДЊ <span class="required">*</span></label>
                                <input type="text" class="form-input" th:field="*{lastName}" 
                                       required placeholder="т▒▒ућ░"
                                       th:classappend="${#fields.hasErrors('lastName')} ? 'error' : ''">
                                <span class="error-message" th:if="${#fields.hasErrors('lastName')}" 
                                      th:errors="*{lastName}"></span>
                            </div>
                            <div class="form-group">
                                <label>тљЇ <span class="required">*</span></label>
                                <input type="text" class="form-input" th:field="*{firstName}" 
                                       required placeholder="тцфжЃј"
                                       th:classappend="${#fields.hasErrors('firstName')} ? 'error' : ''">
                                <span class="error-message" th:if="${#fields.hasErrors('firstName')}" 
                                      th:errors="*{firstName}"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>сЃАсЃ╝сЃФсѓбсЃЅсЃгсѓ╣ <span class="required">*</span></label>
                            <input type="email" class="form-input" th:field="*{email}" 
                                   required placeholder="example@email.com"
                                   th:classappend="${#fields.hasErrors('email')} ? 'error' : ''">
                            <small class="form-hint">сЃГсѓ░сѓцсЃ│IDсЂесЂЌсЂдСй┐ућесЂЋсѓїсЂЙсЂЎ</small>
                            <span class="error-message" th:if="${#fields.hasErrors('email')}" 
                                  th:errors="*{email}"></span>
                        </div>

                        <div class="form-group">
                            <label>сЃЉсѓ╣сЃ»сЃ╝сЃЅ <span class="required">*</span></label>
                            <input type="password" class="form-input" th:field="*{password}" 
                                   required placeholder="8ТќЄтГЌС╗ЦСИі"
                                   th:classappend="${#fields.hasErrors('password')} ? 'error' : ''">
                            <small class="form-hint">УІ▒ТЋ░тГЌсѓњтљФсѓђ8ТќЄтГЌС╗ЦСИісЂДУеГт«џсЂЌсЂдсЂЈсЂасЂЋсЂё</small>
                            <span class="error-message" th:if="${#fields.hasErrors('password')}" 
                                  th:errors="*{password}"></span>
                        </div>

                        <div class="form-group">
                            <label>сЃЉсѓ╣сЃ»сЃ╝сЃЅ№╝ѕуб║УфЇ№╝Ѕ <span class="required">*</span></label>
                            <input type="password" class="form-input" th:field="*{passwordConfirm}" 
                                   required placeholder="сѓѓсЂєСИђт║дтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё"
                                   th:classappend="${#fields.hasErrors('passwordConfirm')} ? 'error' : ''">
                            <span class="error-message" th:if="${#fields.hasErrors('passwordConfirm')}" 
                                  th:errors="*{passwordConfirm}"></span>
                        </div>

                        <div class="form-group">
                            <label>жЏ╗УЕ▒уЋфтЈи <span class="required">*</span></label>
                            <input type="tel" class="form-input" th:field="*{phone}" 
                                   required placeholder="090-1234-5678">
                        </div>

                        <div class="form-group">
                            <label>ућЪт╣┤ТюѕТЌЦ <span class="required">*</span></label>
                            <input type="date" class="form-input" th:field="*{birthDate}" required>
                        </div>

                        <button type="button" class="next-btn" onclick="nextStep(2)">ТгАсЂИжђ▓сѓђ</button>
                    </div>

                    <!-- сѓ╣сЃєсЃЃсЃЌ2: СйЈТЅђТЃЁта▒ -->
                    <div class="form-step" id="step2">
                        <h2>СйЈТЅђТЃЁта▒сЂ«тЁЦтіЏ</h2>

                        <div class="form-group">
                            <label>жЃхСЙ┐уЋфтЈи <span class="required">*</span></label>
                            <div class="postal-input">
                                <input type="text" class="form-input" th:field="*{postalCode}" 
                                       required placeholder="123-4567">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>жЃйжЂЊт║юуюї <span class="required">*</span></label>
                            <select class="form-select" th:field="*{prefecture}" required>
                                <option value="">жЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂё</option>
                                <option value="тїЌТхижЂЊ">тїЌТхижЂЊ</option>
                                <option value="жЮњТБ«уюї">жЮњТБ«уюї</option>
                                <option value="т▓ЕТЅІуюї">т▓ЕТЅІуюї</option>
                                <option value="т««тЪјуюї">т««тЪјуюї</option>
                                <option value="уДІућ░уюї">уДІућ░уюї</option>
                                <option value="т▒▒тйбуюї">т▒▒тйбуюї</option>
                                <option value="удЈт│Хуюї">удЈт│Хуюї</option>
                                <option value="УїетЪјуюї">УїетЪјуюї</option>
                                <option value="ТаЃТюеуюї">ТаЃТюеуюї</option>
                                <option value="уЙцждгуюї">уЙцждгуюї</option>
                                <option value="тЪ╝ујЅуюї">тЪ╝ујЅуюї</option>
                                <option value="тЇЃУЉЅуюї">тЇЃУЉЅуюї</option>
                                <option value="ТЮ▒С║гжЃй">ТЮ▒С║гжЃй</option>
                                <option value="уЦътЦѕтиЮуюї">уЦътЦѕтиЮуюї</option>
                                <option value="Тќ░ТйЪуюї">Тќ░ТйЪуюї</option>
                                <option value="т»їт▒▒уюї">т»їт▒▒уюї</option>
                                <option value="уЪ│тиЮуюї">уЪ│тиЮуюї</option>
                                <option value="удЈС║Ћуюї">удЈС║Ћуюї</option>
                                <option value="т▒▒Тбеуюї">т▒▒Тбеуюї</option>
                                <option value="жЋижЄјуюї">жЋижЄјуюї</option>
                                <option value="т▓љжўюуюї">т▓љжўюуюї</option>
                                <option value="жЮЎт▓Ауюї">жЮЎт▓Ауюї</option>
                                <option value="ТёЏуЪЦуюї">ТёЏуЪЦуюї</option>
                                <option value="СИЅжЄЇуюї">СИЅжЄЇуюї</option>
                                <option value="Т╗ІУ│ђуюї">Т╗ІУ│ђуюї</option>
                                <option value="С║гжЃйт║ю">С║гжЃйт║ю</option>
                                <option value="тцДжўфт║ю">тцДжўфт║ю</option>
                                <option value="тЁхт║Фуюї">тЁхт║Фуюї</option>
                                <option value="тЦѕУЅ»уюї">тЦѕУЅ»уюї</option>
                                <option value="тњїТГїт▒▒уюї">тњїТГїт▒▒уюї</option>
                                <option value="ж│ЦтЈќуюї">ж│ЦтЈќуюї</option>
                                <option value="т│ХТа╣уюї">т│ХТа╣уюї</option>
                                <option value="т▓Ат▒▒уюї">т▓Ат▒▒уюї</option>
                                <option value="т║Ѓт│Хуюї">т║Ѓт│Хуюї</option>
                                <option value="т▒▒тЈБуюї">т▒▒тЈБуюї</option>
                                <option value="тЙ│т│Хуюї">тЙ│т│Хуюї</option>
                                <option value="ждЎтиЮуюї">ждЎтиЮуюї</option>
                                <option value="ТёЏтфЏуюї">ТёЏтфЏуюї</option>
                                <option value="жФўуЪЦуюї">жФўуЪЦуюї</option>
                                <option value="удЈт▓Ауюї">удЈт▓Ауюї</option>
                                <option value="СйљУ│ђуюї">СйљУ│ђуюї</option>
                                <option value="жЋит┤јуюї">жЋит┤јуюї</option>
                                <option value="уєіТюгуюї">уєіТюгуюї</option>
                                <option value="тцДтѕєуюї">тцДтѕєуюї</option>
                                <option value="т««т┤јуюї">т««т┤јуюї</option>
                                <option value="ж╣┐тЁљт│Хуюї">ж╣┐тЁљт│Хуюї</option>
                                <option value="Т▓ќуИёуюї">Т▓ќуИёуюї</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>тИѓтї║ућ║ТЮЉ <span class="required">*</span></label>
                            <input type="text" class="form-input" th:field="*{city}" 
                                   required placeholder="ТИІУ░итї║">
                        </div>

                        <div class="form-group">
                            <label>уЋфтю░ <span class="required">*</span></label>
                            <input type="text" class="form-input" th:field="*{address1}" 
                                   required placeholder="1-2-3">
                        </div>

                        <div class="form-group">
                            <label>т╗║уЅЕтљЇсЃ╗жЃет▒ІуЋфтЈи</label>
                            <input type="text" class="form-input" th:field="*{address2}" 
                                   placeholder="РЌІРЌІсЃъсЃ│сѓисЃДсЃ│ 101тЈит«ц">
                        </div>

                        <div class="button-group">
                            <button type="button" class="back-btn" onclick="prevStep(1)">Тѕ╗сѓІ</button>
                            <button type="button" class="next-btn" onclick="nextStep(3)">ТгАсЂИжђ▓сѓђ</button>
                        </div>
                    </div>

                    <!-- сѓ╣сЃєсЃЃсЃЌ3: сѓбсЃгсЃФсѓ«сЃ╝ТЃЁта▒ -->
                    <div class="form-step" id="step3">
                        <h2>сѓбсЃгсЃФсѓ«сЃ╝ТЃЁта▒сЂ«уЎ╗жї▓</h2>
                        <p class="step-description">УЕ▓тйЊсЂЎсѓІсѓбсЃгсЃФсѓ«сЃ╝сЂїсЂѓсѓїсЂ░жЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂё№╝ѕС╗╗ТёЈ№╝Ѕ</p>

                        <div class="allergy-section">
                            <h3>сѓбсЃгсЃФсѓ«сЃ╝тЊЂуЏ«№╝ѕуЅ╣т«џтјЪТЮљТќЎ8тЊЂуЏ«№╝Ѕ</h3>
                            <div class="checkbox-grid">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="тЇх">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­ЪЦџ</span>
                                        <span class="allergy-name">тЇх</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="т░Јж║д">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­ЪїЙ</span>
                                        <span class="allergy-name">т░Јж║д</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="С╣│УБйтЊЂ">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­ЪЦЏ</span>
                                        <span class="allergy-name">С╣│УБйтЊЂ</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="сЂЮсЂ░">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­ЪЇю</span>
                                        <span class="allergy-name">сЂЮсЂ░</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="УљйУі▒ућЪ">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­ЪЦю</span>
                                        <span class="allergy-name">УљйУі▒ућЪ</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="сЂѕсЂ│">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­Ъдљ</span>
                                        <span class="allergy-name">сЂѕсЂ│</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="сЂІсЂФ">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­Ъдђ</span>
                                        <span class="allergy-name">сЂІсЂФ</span>
                                    </div>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="allergies" value="сѓбсЃ╝сЃбсЃ│сЃЅ">
                                    <div class="checkbox-content">
                                        <span class="allergy-icon">­Ъї░</span>
                                        <span class="allergy-name">сѓбсЃ╝сЃбсЃ│сЃЅ</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="terms-section">
                            <label class="checkbox-item terms-checkbox">
                                <input type="checkbox" th:field="*{agreeTerms}" required>
                                <span><a href="#terms" target="_blank">тѕЕућеУдЈу┤ё</a>сЂе<a href="#privacy" target="_blank">сЃЌсЃЕсѓцсЃљсѓисЃ╝сЃЮсЃфсѓисЃ╝</a>сЂФтљїТёЈсЂЌсЂЙсЂЎ <span class="required">*</span></span>
                            </label>
                            <span class="error-message" th:if="${#fields.hasErrors('agreeTerms')}" 
                                  th:errors="*{agreeTerms}"></span>

                            <label class="checkbox-item">
                                <input type="checkbox" th:field="*{newsletter}">
                                <span>сЃАсЃ╝сЃФсЃъсѓгсѓИсЃ│сѓњтЈЌсЂЉтЈќсѓІ№╝ѕТќ░тЋєтЊЂсѓёсЂітЙЌсЂфТЃЁта▒сѓњсЂіт▒ісЂЉсЂЌсЂЙсЂЎ№╝Ѕ</span>
                            </label>
                        </div>

                        <div class="button-group">
                            <button type="button" class="back-btn" onclick="prevStep(2)">Тѕ╗сѓІ</button>
                            <button type="submit" class="submit-btn">уЎ╗жї▓сЂЎсѓІ</button>
                        </div>
                    </div>
                </form>

                <div class="login-prompt">
                    <p>сЂЎсЂДсЂФсѓбсѓФсѓдсЃ│сЃѕсѓњсЂіТїЂсЂАсЂ«Тќ╣сЂ»<a th:href="@{/login}">сЂЊсЂАсѓЅсЂІсѓЅсЃГсѓ░сѓцсЃ│</a></p>
                </div>
            </div>
        </div>
    </section>

    <script>
        function nextStep(stepNumber) {
            const currentStep = document.querySelector('.form-step.active');
            const inputs = currentStep.querySelectorAll('input[required], select[required]');
            let isValid = true;

            inputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            if (stepNumber === 2) {
                const password = document.querySelector('input[name="password"]').value;
                const passwordConfirm = document.querySelector('input[name="passwordConfirm"]').value;
                if (password !== passwordConfirm) {
                    alert('сЃЉсѓ╣сЃ»сЃ╝сЃЅсЂїСИђУЄ┤сЂЌсЂЙсЂЏсѓЊсђѓ');
                    return;
                }
            }

            if (!isValid) {
                alert('т┐ЁжаѕжаЁуЏ«сѓњсЂЎсЂ╣сЂдтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ');
                return;
            }

            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step' + stepNumber).classList.add('active');

            document.querySelectorAll('.step-indicator .step').forEach((step, index) => {
                if (index < stepNumber) step.classList.add('active');
                else step.classList.remove('active');
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevStep(stepNumber) {
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step' + stepNumber).classList.add('active');

            document.querySelectorAll('.step-indicator .step').forEach((step, index) => {
                if (index < stepNumber) step.classList.add('active');
                else step.classList.remove('active');
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // сЃЂсѓДсЃЃсѓ»сЃюсЃЃсѓ»сѓ╣сѓФсЃ╝сЃЅсЂ«жЂИТіъуіХТЁІсѓњУдќУдџуџёсЂФТЏ┤Тќ░
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxCards = document.querySelectorAll('.checkbox-card input[type="checkbox"]');
            checkboxCards.forEach(checkbox => {
                // тѕЮТюЪуіХТЁІсѓњУеГт«џ
                updateCardState(checkbox);
                
                // тцЅТЏ┤ТЎѓсЂФТЏ┤Тќ░
                checkbox.addEventListener('change', function() {
                    updateCardState(this);
                });
            });

            function updateCardState(checkbox) {
                const card = checkbox.closest('.checkbox-card');
                if (checkbox.checked) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            }
        });
    </script>
    
    <style>
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .alert-error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        .error-message {
            color: #c62828;
            font-size: 0.85em;
            display: block;
            margin-top: 5px;
        }
        .form-input.error, .form-select.error {
            border-color: #c62828;
        }
        /* сЃЂсѓДсЃЃсѓ»сЃюсЃЃсѓ»сѓ╣сѓФсЃ╝сЃЅжЂИТіъТЎѓсЂ«сѓ╣сѓ┐сѓцсЃФ */
        .checkbox-card.selected {
            border-color: #4a7c59;
            background-color: #e8f5e9;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.2);
        }
        .checkbox-card.selected .checkbox-content {
            color: #2d5f3f;
        }
        .checkbox-card.selected .allergy-icon {
            transform: scale(1.2);
        }
        .checkbox-card.selected .allergy-name {
            font-weight: bold;
        }
    </style>
</body>
</html>
