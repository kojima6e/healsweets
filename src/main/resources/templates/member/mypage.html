<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸ - HealSweets</title>
    <link rel="icon" type="image/png" th:href="@{/images/favicon.png}">
    <link rel="stylesheet" th:href="@{/css/member-style.css}">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header th:replace="~{fragments/header :: headerSimple}"></header>

    <!-- ä¼šå“¡ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <section class="member-section">
        <div class="container">
            <div class="page-header">
                <h1>ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
                <p class="welcome-text">ã‚ˆã†ã“ãã€<strong th:text="${member.fullName}">ç”°ä¸­ å¤ªéƒ</strong>æ§˜</p>
            </div>

            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
            <div th:if="${successMessage}" class="alert alert-success">
                <p th:text="${successMessage}">æˆåŠŸ</p>
            </div>
            <div th:if="${errorMessage}" class="alert alert-error">
                <p th:text="${errorMessage}">ã‚¨ãƒ©ãƒ¼</p>
            </div>

            <div class="member-content">
                <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <aside class="sidebar-menu">
                    <a th:href="@{/member?section=info}" 
                       th:classappend="${currentSection == 'info'} ? 'active' : ''"
                       class="menu-item">
                        <span class="menu-icon">ğŸ‘¤</span>
                        <span>ä¼šå“¡æƒ…å ±</span>
                    </a>
                    <a th:href="@{/member?section=orders}" 
                       th:classappend="${currentSection == 'orders'} ? 'active' : ''"
                       class="menu-item">
                        <span class="menu-icon">ğŸ“¦</span>
                        <span>æ³¨æ–‡å±¥æ­´</span>
                    </a>
                    <a th:href="@{/member?section=allergy}" 
                       th:classappend="${currentSection == 'allergy'} ? 'active' : ''"
                       class="menu-item">
                        <span class="menu-icon">ğŸ¥—</span>
                        <span>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç™»éŒ²</span>
                    </a>
                    <a th:href="@{/member?section=withdrawal}" 
                       th:classappend="${currentSection == 'withdrawal'} ? 'active' : ''"
                       class="menu-item">
                        <span class="menu-icon">âš ï¸</span>
                        <span>é€€ä¼šå¸Œæœ›ã®æ–¹</span>
                    </a>
                    <a th:href="@{/member?section=contact}" 
                       th:classappend="${currentSection == 'contact'} ? 'active' : ''"
                       class="menu-item">
                        <span class="menu-icon">ğŸ“§</span>
                        <span>ãŠå•ã„åˆã‚ã›</span>
                    </a>
                </aside>

                <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
                <main class="main-content">
                    <!-- ä¼šå“¡æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div th:if="${currentSection == 'info'}" class="content-section active" id="info">
                        <div class="section-header-with-button">
                            <h2>ä¼šå“¡æƒ…å ±</h2>
                            <button type="button" class="edit-toggle-btn" onclick="toggleEditMode()">ä¿®æ­£</button>
                        </div>
                        
                        <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="info-card" id="info-view-mode">
                            <div class="info-row">
                                <label>ãŠåå‰</label>
                                <div class="info-value">
                                    <span th:text="${member.fullName}">ç”°ä¸­ å¤ªéƒ</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                <div class="info-value">
                                    <span th:text="${member.email}">example@email.com</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <label>é›»è©±ç•ªå·</label>
                                <div class="info-value">
                                    <span th:text="${member.phone}">090-1234-5678</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <label>ä½æ‰€</label>
                                <div class="info-value">
                                    <span th:utext="${member.fullAddress}">ã€’123-4567 æ±äº¬éƒ½æ¸‹è°·åŒºâ—‹â—‹ 1-2-3</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <label>ç”Ÿå¹´æœˆæ—¥</label>
                                <div class="info-value">
                                    <span th:text="${#temporals.format(member.birthDate, 'yyyyå¹´Mæœˆdæ—¥')}">1990å¹´1æœˆ1æ—¥</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="info-card edit-mode" id="info-edit-mode" style="display: none;">
                            <form th:action="@{/member/update}" method="post" class="member-edit-form">
                                <div class="info-row">
                                    <label>ãŠåå‰</label>
                                    <div class="edit-fields">
                                        <input type="text" name="lastName" th:value="${member.lastName}" placeholder="å§“" required class="form-input-half">
                                        <input type="text" name="firstName" th:value="${member.firstName}" placeholder="å" required class="form-input-half">
                                    </div>
                                </div>
                                <div class="info-row">
                                    <label>é›»è©±ç•ªå·</label>
                                    <div class="edit-fields">
                                        <input type="tel" name="phone" th:value="${member.phone}" placeholder="090-1234-5678" class="form-input">
                                    </div>
                                </div>
                                <div class="info-row">
                                    <label>ä½æ‰€</label>
                                    <div class="edit-fields address-fields">
                                        <input type="text" name="postalCode" th:value="${member.postalCode}" placeholder="éƒµä¾¿ç•ªå·" class="form-input-small">
                                        <input type="text" name="prefecture" th:value="${member.prefecture}" placeholder="éƒ½é“åºœçœŒ" class="form-input-small">
                                        <input type="text" name="city" th:value="${member.city}" placeholder="å¸‚åŒºç”ºæ‘" class="form-input">
                                        <input type="text" name="address1" th:value="${member.address1}" placeholder="ç•ªåœ°" class="form-input">
                                        <input type="text" name="address2" th:value="${member.address2}" placeholder="å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·" class="form-input">
                                    </div>
                                </div>
                                <div class="info-row">
                                    <label>ç”Ÿå¹´æœˆæ—¥</label>
                                    <div class="edit-fields">
                                        <input type="date" name="birthDate" th:value="${member.birthDate}" class="form-input">
                                    </div>
                                </div>
                                <div class="form-actions-member">
                                    <button type="button" class="cancel-btn" onclick="toggleEditMode()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                    <button type="submit" class="submit-btn">ä¿å­˜</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- æ³¨æ–‡å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div th:if="${currentSection == 'orders'}" class="content-section active" id="orders">
                        <h2>æ³¨æ–‡å±¥æ­´</h2>
                        
                        <!-- æ³¨æ–‡ãŒãªã„å ´åˆ -->
                        <div th:if="${#lists.isEmpty(orders)}" class="no-orders-card">
                            <div class="no-orders-icon">ğŸ“¦</div>
                            <h3>è³¼å…¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                            <p>ã¾ã ã”æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å•†å“ã‚’æ¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                            <a th:href="@{/}" class="shop-btn">å•†å“ã‚’è¦‹ã‚‹</a>
                        </div>
                        
                        <!-- æ³¨æ–‡ãŒã‚ã‚‹å ´åˆ -->
                        <div th:if="${!#lists.isEmpty(orders)}" class="orders-list">
                            <div th:each="order : ${orders}" class="order-card">
                                <div class="order-header">
                                    <div class="order-info">
                                        <span class="order-number">æ³¨æ–‡ç•ªå·: <strong th:text="${order.orderNumber}">HS1234567890</strong></span>
                                        <span class="order-date" th:text="${#temporals.format(order.createdAt, 'yyyyå¹´Mæœˆdæ—¥ HH:mm')}">2025å¹´1æœˆ1æ—¥ 12:00</span>
                                    </div>
                                    <div class="order-status">
                                        <span class="status-badge" 
                                              th:classappend="${#strings.toLowerCase(order.status.name())}"
                                              th:text="${order.status.displayName}">å‡¦ç†ä¸­</span>
                                    </div>
                                </div>
                                
                                <div class="order-items">
                                    <div th:each="item : ${order.orderItems}" class="order-item">
                                        <img th:src="${item.product.imageUrl}" th:alt="${item.productName}" class="item-image">
                                        <div class="item-details">
                                            <span class="item-name" th:text="${item.productName}">å•†å“å</span>
                                            <span class="item-price" th:text="${item.formattedUnitPrice} + ' Ã— ' + ${item.quantity}">Â¥1,000 Ã— 2</span>
                                        </div>
                                        <span class="item-subtotal" th:text="${item.formattedSubtotal}">Â¥2,000</span>
                                    </div>
                                </div>
                                
                                <div class="order-footer">
                                    <div class="order-shipping">
                                        <span>é…é€å…ˆ: </span>
                                        <span th:text="${order.shippingName} + 'æ§˜'">ç”°ä¸­ å¤ªéƒæ§˜</span>
                                    </div>
                                    <div class="order-summary">
                                        <div class="order-shipping-fee">
                                            <span>é€æ–™: </span>
                                            <span th:text="${order.formattedShippingFee}">Â¥500</span>
                                        </div>
                                        <div class="order-total">
                                            <span>åˆè¨ˆé‡‘é¡: </span>
                                            <strong th:text="${order.formattedTotal}">Â¥3,000</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
                                <!-- å‡¦ç†ä¸­ã¾ãŸã¯ç¢ºèªæ¸ˆã¿ã®å ´åˆã®ã¿ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ -->
                                <div th:if="${order.status.name() == 'PENDING' || order.status.name() == 'CONFIRMED'}" class="order-cancel-section">
                                    <button type="button" class="order-cancel-btn" 
                                            th:onclick="'openCancelModal(' + ${order.id} + ')'">æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                </div>
                                <!-- ç™ºé€æ¸ˆã¿ã®å ´åˆã®ã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆé…é”å®Œäº†ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿ã¯è¡¨ç¤ºã—ãªã„ï¼‰ -->
                                <div th:if="${order.status.name() == 'SHIPPED'}" class="order-cancel-section cancel-not-available">
                                    <p>ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ã§ãã¾ã›ã‚“ã€‚è©³ç´°ã¯<a th:href="@{/member?section=contact}">ãŠå•ã„åˆã‚ã›</a>ãã ã•ã„ã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç™»éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div th:if="${currentSection == 'allergy'}" class="content-section active" id="allergy">
                        <h2>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç™»éŒ²</h2>
                   
                        
                        <div class="allergy-card">
                            <h3>ç™»éŒ²æ¸ˆã¿ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</h3>
                            <div class="allergy-tags">
                                <span th:each="allergy : ${member.allergies}" class="allergy-tag">
                                    <span th:text="${allergy}">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</span>
                                </span>
                                <p th:if="${#lists.isEmpty(member.allergies)}">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                            </div>

                            <form th:action="@{/member/allergies}" method="post" class="allergy-form">
                                <h3>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã‚’æ›´æ–°</h3>
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="åµ" 
                                               th:checked="${#lists.contains(member.allergies, 'åµ')}">
                                        <span>åµ</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="å°éº¦"
                                               th:checked="${#lists.contains(member.allergies, 'å°éº¦')}">
                                        <span>å°éº¦</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="ä¹³è£½å“"
                                               th:checked="${#lists.contains(member.allergies, 'ä¹³è£½å“')}">
                                        <span>ä¹³è£½å“</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="ãã°"
                                               th:checked="${#lists.contains(member.allergies, 'ãã°')}">
                                        <span>ãã°</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="è½èŠ±ç”Ÿ"
                                               th:checked="${#lists.contains(member.allergies, 'è½èŠ±ç”Ÿ')}">
                                        <span>è½èŠ±ç”Ÿ</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="ãˆã³"
                                               th:checked="${#lists.contains(member.allergies, 'ãˆã³')}">
                                        <span>ãˆã³</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="ã‹ã«"
                                               th:checked="${#lists.contains(member.allergies, 'ã‹ã«')}">
                                        <span>ã‹ã«</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="allergies" value="ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰"
                                               th:checked="${#lists.contains(member.allergies, 'ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰')}">
                                        <span>ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰</span>
                                    </label>
                                </div>
                                <button type="submit" class="submit-btn">æ›´æ–°ã™ã‚‹</button>
                            </form>
                        </div>
                    </div>

                    <!-- é€€ä¼šå¸Œæœ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div th:if="${currentSection == 'withdrawal'}" class="content-section active" id="withdrawal">
                        <h2>é€€ä¼šå¸Œæœ›ã®æ–¹</h2>
                        <div class="warning-card">
                            <div class="warning-icon">âš ï¸</div>
                            <h3>é€€ä¼šã•ã‚Œã‚‹å‰ã«ã”ç¢ºèªãã ã•ã„</h3>
                            <ul class="warning-list">
                                <li>é€€ä¼šã™ã‚‹ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™</li>
                                <li>éå»ã®æ³¨æ–‡å±¥æ­´ãŒé–²è¦§ã§ããªããªã‚Šã¾ã™</li>
                             
                            </ul>

                            <form th:action="@{/member/withdraw}" method="post" class="withdrawal-form">
                                <label>é€€ä¼šç†ç”±ã‚’ãŠèã‹ã›ãã ã•ã„ï¼ˆä»»æ„ï¼‰</label>
                                <textarea name="reason" class="withdrawal-reason" placeholder="é€€ä¼šç†ç”±ã‚’ã”è¨˜å…¥ãã ã•ã„"></textarea>

                                <label class="checkbox-item confirm-checkbox">
                                    <input type="checkbox" id="confirm-withdrawal" required>
                                    <span>ä¸Šè¨˜ã®å†…å®¹ã‚’ç†è§£ã—ã€é€€ä¼šã‚’å¸Œæœ›ã—ã¾ã™</span>
                                </label>

                                <button type="submit" class="danger-btn" id="withdrawal-btn" 
                                        onclick="return confirm('æœ¬å½“ã«é€€ä¼šã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')">
                                    é€€ä¼šã™ã‚‹
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- ãŠå•ã„åˆã‚ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div th:if="${currentSection == 'contact'}" class="content-section active" id="contact">
                        <h2>ãŠå•ã„åˆã‚ã›</h2>
                        <p class="section-description">ã”è³ªå•ã‚„ã”è¦æœ›ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
                        
                        <div class="contact-card">
                            <form th:action="@{/member/contact}" th:object="${contactDto}" method="post" class="contact-form">
                                <div class="form-group">
                                    <label>ãŠå•ã„åˆã‚ã›ç¨®åˆ¥</label>
                                    <select class="form-select" th:field="*{category}" required>
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="å•†å“ã«ã¤ã„ã¦">å•†å“ã«ã¤ã„ã¦</option>
                                        <option value="é…é€ã«ã¤ã„ã¦">é…é€ã«ã¤ã„ã¦</option>
                                        <option value="è¿”å“ãƒ»äº¤æ›ã«ã¤ã„ã¦">è¿”å“ãƒ»äº¤æ›ã«ã¤ã„ã¦</option>
                                        <option value="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¤ã„ã¦">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¤ã„ã¦</option>
                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>ä»¶å</label>
                                    <input type="text" class="form-input" th:field="*{subject}" 
                                           placeholder="ä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>
                                </div>

                                <div class="form-group">
                                    <label>ãŠå•ã„åˆã‚ã›å†…å®¹</label>
                                    <textarea class="form-textarea" th:field="*{message}" 
                                              placeholder="ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’è©³ã—ãã”è¨˜å…¥ãã ã•ã„" required></textarea>
                                </div>

                                <button type="submit" class="submit-btn">é€ä¿¡ã™ã‚‹</button>
                            </form>

                            <div class="contact-info">
                                <h3>ãã®ä»–ã®ãŠå•ã„åˆã‚ã›æ–¹æ³•</h3>
                                <div class="contact-method">
                                    <span class="contact-icon">ğŸ“</span>
                                    <div>
                                        <p><strong>ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›</strong></p>
                                        <p>TEL: 092-401-1835</p>
                                        <p class="contact-time">å—ä»˜æ™‚é–“: å¹³æ—¥ 10:00-18:00</p>
                                    </div>
                                </div>
                                <div class="contact-method">
                                    <span class="contact-icon">âœ‰ï¸</span>
                                    <div>
                                        <p><strong>ãƒ¡ãƒ¼ãƒ«ã§ã®ãŠå•ã„åˆã‚ã›</strong></p>
                                        <p>support@healsweets.com</p>
                                        <p class="contact-time">24æ™‚é–“å—ä»˜ï¼ˆè¿”ä¿¡ã¯å–¶æ¥­æ™‚é–“å†…ï¼‰</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </section>
    
    <style>
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .alert-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }
        .menu-item {
            text-decoration: none;
            color: inherit;
        }

        /* ===========================================
           ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
           =========================================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            transform: scale(0.9) translateY(-20px);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .modal-overlay.active .modal-container {
            transform: scale(1) translateY(0);
        }

        .modal-body {
            padding: 30px;
            text-align: center;
        }

        .modal-body p {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            padding: 20px 30px 30px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .modal-btn-cancel:hover {
            background: #e0e0e0;
        }

        .modal-btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .modal-btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        @media (max-width: 480px) {
            .modal-container {
                width: 95%;
                margin: 10px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
    </style>

    <!-- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="cancelModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-body">
                <p>æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeCancelModal()">
                    ã„ã„ãˆ
                </button>
                <form id="cancelForm" method="post" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="modal-btn modal-btn-danger">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openCancelModal(orderId) {
            var modal = document.getElementById('cancelModal');
            var form = document.getElementById('cancelForm');
            form.action = '/member/orders/' + orderId + '/cancel';
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ä¼šå“¡æƒ…å ±ã®ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleEditMode() {
            const viewMode = document.getElementById('info-view-mode');
            const editMode = document.getElementById('info-edit-mode');
            const editBtn = document.querySelector('.edit-toggle-btn');
            
            if (viewMode && editMode) {
                if (viewMode.style.display === 'none') {
                    viewMode.style.display = 'block';
                    editMode.style.display = 'none';
                    editBtn.textContent = 'ä¿®æ­£';
                } else {
                    viewMode.style.display = 'none';
                    editMode.style.display = 'block';
                    editBtn.textContent = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            const cancelModal = document.getElementById('cancelModal');
            if (cancelModal) {
                cancelModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCancelModal();
                    }
                });
            }

            // Escã‚­ãƒ¼ã§é–‰ã˜ã‚‹
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeCancelModal();
                }
            });

            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®é¸æŠçŠ¶æ…‹ã‚’ç®¡ç†
            const checkboxItems = document.querySelectorAll('.checkbox-group .checkbox-item');
            checkboxItems.forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    // åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
                    if (checkbox.checked) {
                        item.classList.add('selected');
                    }
                    
                    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¤‰æ›´æ™‚ã«æ›´æ–°
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    });
                    
                    // ãƒ©ãƒ™ãƒ«å…¨ä½“ã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«
                    item.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
