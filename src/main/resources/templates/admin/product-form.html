<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit ? '商品編集' : '商品追加'} + ' - HealSweets'">商品管理 - HealSweets</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
</head>
<body>
    <div th:replace="~{fragments/admin-header :: adminHeader}"></div>

    <main class="admin-container">
        <div class="admin-page-header">
            <div>
                <h1 th:text="${isEdit ? '商品編集' : '商品追加'}">商品管理</h1>
                <p th:text="${isEdit ? '商品情報を編集します' : '新しい商品を登録します'}"></p>
            </div>
            <a th:href="@{/admin/products}" class="btn btn-secondary">← 商品一覧に戻る</a>
        </div>

        <!-- エラーメッセージ表示 -->
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <!-- 商品フォーム -->
        <div class="form-container">
            <form th:action="${isEdit ? '/admin/products/' + productDto.id + '/edit' : '/admin/products/new'}" 
                  th:object="${productDto}" 
                  method="post">

                <div class="form-section">
                    <h2>基本情報</h2>

                    <div class="form-group">
                        <label for="name">商品名 <span class="required">*</span></label>
                        <input type="text" id="name" th:field="*{name}" class="form-control" required>
                        <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="description">商品説明</label>
                        <textarea id="description" th:field="*{description}" class="form-control" rows="5"></textarea>
                        <span th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="error-message"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">価格（円） <span class="required">*</span></label>
                            <input type="number" id="price" th:field="*{price}" class="form-control" min="0" required>
                            <span th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="error-message"></span>
                        </div>

                        <div class="form-group">
                            <label for="stock">在庫数 <span class="required">*</span></label>
                            <input type="number" id="stock" th:field="*{stock}" class="form-control" min="0" required>
                            <span th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}" class="error-message"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="category">カテゴリ</label>
                        <select id="category" th:field="*{category}" class="form-control">
                            <option value="">カテゴリを選択</option>
                            <option value="allergen-free">アレルゲンフリー</option>
                            <option value="low-sugar">低糖質</option>
                            <option value="cacao">カカオ70%</option>
                            <option value="seasonal">季節限定</option>
                            <option value="gift">ギフト</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="imageUrl">画像URL</label>
                        <input type="text" id="imageUrl" th:field="*{imageUrl}" class="form-control" placeholder="/images/item01.jpg">
                        <small class="form-text">例: /images/item01.jpg</small>
                    </div>
                </div>

                <div class="form-section">
                    <h2>商品詳細</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">内容量</label>
                            <input type="text" id="quantity" th:field="*{quantity}" class="form-control" placeholder="例: 12個入り">
                        </div>

                        <div class="form-group">
                            <label for="expiryDays">賞味期限</label>
                            <input type="text" id="expiryDays" th:field="*{expiryDays}" class="form-control" placeholder="例: 製造日より30日">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="storageMethod">保存方法</label>
                        <input type="text" id="storageMethod" th:field="*{storageMethod}" class="form-control" placeholder="例: 直射日光・高温多湿を避けて保存">
                    </div>
                </div>

                <div class="form-section">
                    <h2>アレルゲン情報</h2>
                    <div class="form-group">
                        <label>アレルゲン（複数選択可）</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="小麦"> 小麦
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="卵"> 卵
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="乳製品"> 乳製品
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="ナッツ類"> ナッツ類
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="アーモンド"> アーモンド
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="くるみ"> くるみ
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{allergens}" value="大豆"> 大豆
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>商品特徴</h2>
                    <div class="form-group">
                        <label>特徴（複数選択可）</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ グルテンフリー"> グルテンフリー
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 卵不使用"> 卵不使用
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 乳製品不使用"> 乳製品不使用
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 添加物不使用"> 添加物不使用
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 国産素材使用"> 国産素材使用
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 低糖質"> 低糖質
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ 個包装"> 個包装
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" th:field="*{features}" value="✓ ギフト対応"> ギフト対応
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>販売設定</h2>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" th:field="*{active}"> この商品を販売する
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span th:text="${isEdit ? '更新' : '登録'}">登録</span>
                    </button>
                    <a th:href="@{/admin/products}" class="btn btn-secondary">キャンセル</a>
                </div>
            </form>
        </div>
    </main>

</body>
</html>
