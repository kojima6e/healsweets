<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealSweets - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢</title>
    <link rel="icon" type="image/png" th:href="@{/images/favicon.png}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ã‚«ãƒ†ã‚´ãƒªãƒ¼è¤‡æ•°é¸æŠç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .category-card {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .category-card.selected {
            background-color: #e8f5e9;
            border-color: #4a7c59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.2);
        }
        

        
        .filter-info {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        .filter-info .selected-count {
            font-weight: bold;
            color: #4a7c59;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .login-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: #dc3545;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .login-btn:hover {
            background-color: #c82333;
        }
        
        .login-btn-icon {
            font-size: 1em;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .header-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .header-btn-primary {
            background-color: #4a7c59;
            color: white;
        }
        
        .header-btn-primary:hover {
            background-color: #3a6349;
        }
        
        .header-btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .header-btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .header-btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .header-btn-danger:hover {
            background-color: #c82333;
        }
        
        /* ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .cart-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            background-color: #17a2b8;
            color: white;
        }
        
        .cart-btn:hover {
            background-color: #138496;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #dc3545;
            color: white;
            font-size: 0.75em;
            font-weight: bold;
            min-width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }
        
        /* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ã‚©ãƒ¼ãƒ  */
        .logout-form {
            display: inline;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="container">
            <div class="header-spacer"></div>
            <div class="logo">
                <a th:href="@{/}">
                    <img th:src="@{/images/logo.png}" alt="HealSweets" class="logo-image">
                </a>
            </div>
            <div class="header-icons">
                <!-- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
                <a sec:authorize="!isAuthenticated()" th:href="@{/login}" class="login-btn">
                    <span class="login-btn-icon">âœ</span>
                    <span>ãƒ­ã‚°ã‚¤ãƒ³</span>
                </a>
                
                <!-- ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šãƒã‚¤ãƒšãƒ¼ã‚¸ã€ã‚«ãƒ¼ãƒˆã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
                <a sec:authorize="isAuthenticated()" th:href="@{/member}" class="header-btn header-btn-primary">
                    <span>ğŸ‘¤</span>
                    <span>ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
                </a>
                <a sec:authorize="isAuthenticated()" th:href="@{/cart}" class="cart-btn">
                    <span>ğŸ›’</span>
                    <span>ã‚«ãƒ¼ãƒˆ</span>
                    <span th:if="${cartItemCount > 0}" class="cart-badge" th:text="${cartItemCount}">0</span>
                </a>
                <form sec:authorize="isAuthenticated()" th:action="@{/logout}" method="post" class="logout-form">
                    <button type="submit" class="header-btn header-btn-danger">â¬… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </form>
            </div>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ï¼‰ -->
    <section class="hero">
        <div class="hero-slideshow">
            <div class="hero-slide active" th:style="'background-image: url(/images/CS_cake_1_pc.jpg);'"></div>
            <div class="hero-slide" th:style="'background-image: url(/images/CS_cake_2_pc.jpg);'"></div>
            <div class="hero-slide" th:style="'background-image: url(/images/CS_cake_3_pc.jpg);'"></div>
        </div>
    </section>

    <!-- æ¤œç´¢ãƒãƒ¼ -->
    <div class="search-container">
        <form th:action="@{/search}" method="get" class="search-form">
            <input type="text" name="keyword" placeholder="å•†å“åãƒ»å•†å“èª¬æ˜æ–‡ã§æ¤œç´¢" class="search-input" 
                   th:value="${keyword}">
            <button type="submit" class="search-btn">
                <span class="search-icon">ğŸ”</span>
                <span class="search-text">æ¤œç´¢</span>
            </button>
        </form>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆè¤‡æ•°é¸æŠå¯èƒ½ãƒ»ANDæ¤œç´¢ï¼‰ -->
    <section class="categories-section" id="categories">
        <div class="category-grid">
            <div th:classappend="${#lists.isEmpty(selectedCategories)} ? 'selected' : ''"
                 class="category-card" data-category="all">
                <div class="category-icon">ğŸŒ¿</div>
                <h3>ã™ã¹ã¦</h3>
            </div>
            <div th:classappend="${selectedCategories.contains('allergen-free')} ? 'selected' : ''"
                 class="category-card" data-category="allergen-free">
                <div class="category-icon">ğŸ¥—</div>
                <h3>ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³ãƒ•ãƒªãƒ¼</h3>
            </div>
            <div th:classappend="${selectedCategories.contains('low-sugar')} ? 'selected' : ''"
                 class="category-card" data-category="low-sugar">
                <div class="category-icon">ğŸ¬</div>
                <h3>ä½ç³–è³ª</h3>
            </div>
            <div th:classappend="${selectedCategories.contains('cacao')} ? 'selected' : ''"
                 class="category-card" data-category="cacao">
                <div class="category-icon">ğŸ«</div>
                <h3>ã‚«ã‚«ã‚ª70%</h3>
            </div>
        </div>
        
        <div class="filter-info">
            <span id="filterStatus">
                <span th:if="${#lists.isEmpty(selectedCategories)}">ã™ã¹ã¦ã®å•†å“ã‚’è¡¨ç¤ºä¸­</span>
                <span th:unless="${#lists.isEmpty(selectedCategories)}">
                    <span class="selected-count" th:text="${#lists.size(selectedCategories)}">0</span>ä»¶ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§çµã‚Šè¾¼ã¿ä¸­ï¼ˆã™ã¹ã¦æº€ãŸã™å•†å“ã‚’è¡¨ç¤ºï¼‰
                </span>
            </span>
        </div>
    </section>

    <!-- å•†å“ä¸€è¦§ -->
    <section class="products-section" id="productsSection">
        <div class="container">
            <div class="section-header">
                <h2>å•†å“ä¸€è¦§</h2>
            </div>

            <div class="products-grid" id="productsGrid">
                <a th:each="product : ${products}" 
                   th:href="@{/products/{id}(id=${product.id})}" 
                   class="product-card"
                   th:classappend="${product.stock <= 0} ? 'sold-out' : ''"
                   th:data-category="${product.category}">
                    <div class="product-image-wrapper">
                        <img th:src="${product.imageUrl}" th:alt="${product.name}">
                        <div th:if="${product.stock <= 0}" class="sold-out-overlay">
                            <span class="sold-out-text">å£²ã‚Šåˆ‡ã‚Œ</span>
                        </div>
                        <div th:if="${product.stock > 0 and product.stock <= 5}" class="low-stock-badge">
                            <span>æ®‹ã‚Š<span th:text="${product.stock}"></span>ç‚¹</span>
                        </div>
                    </div>
                    <h3 th:text="${product.name}">å•†å“å</h3>
                    <p class="price" th:text="${product.formattedPrice}">Â¥0</p>
                </a>
                
                <p th:if="${#lists.isEmpty(products)}" class="no-products">
                    å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
                </p>
            </div>
        </div>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <script>
        // ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼æ©Ÿèƒ½
        const slides = document.querySelectorAll('.hero-slide');
        let currentSlide = 0;

        function nextSlide() {
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
        }

        // 5ç§’ã”ã¨ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ
        if (slides.length > 1) {
            setInterval(nextSlide, 5000);
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠæ©Ÿèƒ½ï¼ˆé¸æŠæ™‚ã«è‡ªå‹•ã§çµã‚Šè¾¼ã¿ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const categoryCards = document.querySelectorAll('.category-card');
            
            // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            categoryCards.forEach(card => {
                card.addEventListener('click', function() {
                    const category = this.dataset.category;
                    
                    if (category === 'all') {
                        // ã€Œã™ã¹ã¦ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ å…¨å•†å“è¡¨ç¤º
                        window.location.href = '/#productsSection';
                    } else {
                        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ãƒˆã‚°ãƒ«ã—ã¦å³åº§ã«çµã‚Šè¾¼ã¿
                        const isSelected = this.classList.contains('selected');
                        
                        // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å–å¾—
                        let selectedCategories = [];
                        document.querySelectorAll('.category-card.selected:not([data-category="all"])').forEach(c => {
                            selectedCategories.push(c.dataset.category);
                        });
                        
                        if (isSelected) {
                            // é¸æŠè§£é™¤
                            selectedCategories = selectedCategories.filter(c => c !== category);
                        } else {
                            // é¸æŠè¿½åŠ 
                            selectedCategories.push(category);
                        }
                        
                        // URLã‚’æ§‹ç¯‰ã—ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                        if (selectedCategories.length === 0) {
                            window.location.href = '/#productsSection';
                        } else {
                            const params = selectedCategories.map(c => 'categories=' + encodeURIComponent(c)).join('&');
                            window.location.href = '/?' + params + '#productsSection';
                        }
                    }
                });
            });
            
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆã€å•†å“ä¸€è¦§ã¸ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            if (window.location.hash === '#productsSection') {
                setTimeout(function() {
                    const productsSection = document.getElementById('productsSection');
                    if (productsSection) {
                        productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>
